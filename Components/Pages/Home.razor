@using System.Net.Http.Json
@using myapp.Models
@inject IHttpClientFactory ClientFactory
@code {
    private List<Conta> contas;
    private HttpClient Http { get; set; } // Add a property to hold the HttpClient
    private Conta novaConta = new Conta();

    protected override async Task OnInitializedAsync()
    {
        Http = ClientFactory.CreateClient("MyApi"); // Get the named HttpClient

        try
        {
            contas = await Http.GetFromJsonAsync<List<Conta>>("api/Conta");
        }
        catch (Exception ex)
        {
            // Log the exception or display an error message
            Console.WriteLine($"Error fetching data: {ex.Message}");
        }
    }

    private async Task CriarConta()
    {
        await Http.PostAsJsonAsync("api/Conta", novaConta);
        novaConta = new Conta(); // Clear the form
        contas = await Http.GetFromJsonAsync<List<Conta>>("api/Conta"); // Refresh the list
    }
}


@page "/"

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<h2>Existing Accounts</h2>
@if (contas == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <ul>
        @foreach (var conta in contas)
        {
            <li>@conta.NomeCliente (ID: @conta.Id, Saldo: @conta.Saldo.ToString("C2"))</li>
        }
    </ul>
}

<h2>Create New Account</h2>
<EditForm Model="@novaConta" OnValidSubmit="@CriarConta">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div>
        <label for="nomeCliente">Nome do Cliente:</label>
        <InputText id="nomeCliente" @bind-Value="novaConta.NomeCliente" />
    </div>
    <div>
        <label for="saldo">Saldo Inicial:</label>
        <InputNumber id="saldo" @bind-Value="novaConta.Saldo" />
    </div>
    <button type="submit">Criar Conta</button>
</EditForm>
